###############################################################
# FILE: martin/config.yaml
# Role: Martin MVT tile server configuration.
# Agent boundary: Martin config layer (§7, §10)
# Dependencies: PostgreSQL db service healthy; sql/functions.sql applied (tile_heatmap function exists)
# Output: MVT tiles at http://martin:3000/tile_heatmap/{z}/{x}/{y}?sort=X&metric=Y
# How to test: curl "http://localhost:3000/tile_heatmap/6/31/21?sort=overall&metric=score" | file -
#
# IMPORTANT: Martin caches tiles in memory. If sort table data changes after
# pipeline ingestion, restart Martin: docker compose restart martin
#
# Martin v1.x notes:
#   - auto_publish: true re-enables auto-discovery of tables and functions
#   - When a postgres: block is present, DATABASE_URL env var is ignored.
#     The connection_string must be given explicitly in the block.
#   - cors: true allows all origins
###############################################################

# Server settings
listen_addresses: "0.0.0.0:3000"

# Worker threads (tune for production)
worker_processes: 4

# CORS — allow all origins in dev
cors: true

postgres:
  connection_string: ${DATABASE_URL}
  auto_publish: true
  tables:
    county_outlines:
      schema: public
      table: county_outlines
      srid: 4326
      geometry_column: geom
      bounds:
        - -10.493697908251221
        - 51.411180267672506
        - -5.887347306281556
        - 55.29881656409948
      geometry_type: MULTIPOLYGON
      properties:
        id: integer
        county: text
